---
import Layout from '@/layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('news'))
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime())
  .slice(0, 3);
---

<Layout title="–û—Ñ—ñ—Å –ù–ì–ê - –û—Ñ—ñ—Å –ù–µ–∑–∞–ª–µ–∂–Ω–æ–≥–æ –ì—Ä–æ–º–∞–¥—Å—å–∫–æ–≥–æ –ê—É–¥–∏—Ç—É">
  <!-- Hero Section -->
  <section class="relative bg-white py-20 sm:py-32">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="mx-auto max-w-3xl text-center">
        <div class="accent-bar-left mb-8 inline-block">
          <h1 class="text-3xl font-bold text-gray-900 sm:text-5xl lg:text-6xl leading-tight">
            –û—Ñ—ñ—Å –ù–µ–∑–∞–ª–µ–∂–Ω–æ–≥–æ –ì—Ä–æ–º–∞–¥—Å—å–∫–æ–≥–æ –ê—É–¥–∏—Ç—É
          </h1>
        </div>
        <p class="mt-6 text-lg sm:text-xl text-gray-600 leading-relaxed">
          –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –≤–ª–∞–¥—É –ø—ñ–¥ –¢–≤—ñ–π –∫–æ–Ω—Ç—Ä–æ–ª—å.
        </p>
        <div class="mt-12 flex flex-col gap-4 sm:flex-row sm:justify-center">
          <a href="/news" class="btn-primary inline-block text-center">
            –ß–∏—Ç–∞—Ç–∏ –ù–æ–≤–∏–Ω–∏
          </a>
          <a href="/#about" class="btn-secondary inline-block text-center">
            –î—ñ–∑–Ω–∞—Ç–∏—Å—è –ë—ñ–ª—å—à–µ
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Latest Posts Preview -->
  <section class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-20 border-t border-gray-200">
    <div class="mb-12">
      <h2 class="text-4xl font-bold text-gray-900 accent-bar-left">–û—Å—Ç–∞–Ω–Ω—ñ –ê—É–¥–∏—Ç–∏</h2>
      <p class="mt-4 text-lg text-gray-600">–ê–∫—Ç—É–∞–ª—å–Ω—ñ –∑–≤—ñ—Ç–∏ –ø—Ä–æ –ø—Ä–æ–≤–µ–¥–µ–Ω—ñ —Ä–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è</p>
    </div>
    <div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
      {
        posts.map((post) => (
          <a href={`/news/${post.slug}`} class="group card">
            <div class="mb-4 h-40 overflow-hidden rounded-lg bg-gray-200">
              {post.data.image && (
                <img
                  src={post.data.image}
                  alt={post.data.title}
                  class="h-full w-full object-cover transition-transform group-hover:scale-105"
                />
              )}
            </div>
            <p class="text-sm font-semibold text-blue-700">
              {new Date(post.data.pubDate).toLocaleDateString('uk-UA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
              })}
            </p>
            <h3 class="mt-3 text-xl font-bold text-gray-900 group-hover:text-blue-700 transition-colors">
              {post.data.title}
            </h3>
            <p class="mt-2 line-clamp-2 text-gray-600">{post.data.description}</p>
            <div class="mt-4 flex items-center gap-2 text-sm font-semibold text-blue-700">
              –ß–∏—Ç–∞—Ç–∏ –¥–∞–ª—ñ ‚Üí
            </div>
          </a>
        ))
      }
    </div>
    <div class="mt-12 text-center">
      <a href="/news" class="btn-primary">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –í—Å—ñ –ü—É–±–ª—ñ–∫–∞—Ü—ñ—ó</a>
    </div>
  </section>

  <!-- About Section -->
  <section id="about" class="border-t border-gray-200 bg-white py-20">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="grid gap-12 lg:grid-cols-2 lg:gap-8">
        <div>
          <h2 class="text-4xl font-bold text-gray-900 accent-bar-left">–ü—Ä–æ –û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—é</h2>
          <p class="mt-4 text-lg text-gray-600 leading-relaxed">
            –û—Ñ—ñ—Å –ù–ì–ê - —Ü–µ –≥—Ä–æ–º–∞–¥—Å—å–∫–∞ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è, —è–∫–∞ —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑—É—î—Ç—å—Å—è –Ω–∞ –≤–∏—è–≤–ª–µ–Ω–Ω—ñ —Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç—É–≤–∞–Ω–Ω—ñ —Ñ–∞–∫—Ç—ñ–≤ –∫–æ—Ä—É–ø—Ü—ñ—ó —Ç–∞ –Ω–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –±—é–¥–∂–µ—Ç–Ω–∏—Ö –∫–æ—à—Ç—ñ–≤.
          </p>
          <div class="mt-8 space-y-4">
            <div class="flex gap-4">
              <div class="flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-lg bg-blue-100">
                <span class="text-xl">üîç</span>
              </div>
              <div>
                <h3 class="font-bold text-gray-900">–ù–µ–∑–∞–ª–µ–∂–Ω—ñ –†–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è</h3>
                <p class="mt-1 text-gray-600">–ü—Ä–æ–≤–æ–¥–∏–º–æ –≥–ª–∏–±–æ–∫—ñ –∞—É–¥–∏—Ç–∏ –±–µ–∑ –≤–ø–ª–∏–≤—É –ø–æ–ª—ñ—Ç–∏—á–Ω–∏—Ö —Å–∏–ª</p>
              </div>
            </div>
            <div class="flex gap-4">
              <div class="flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-lg bg-yellow-100">
                <span class="text-xl">üìä</span>
              </div>
              <div>
                <h3 class="font-bold text-gray-900">–ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å</h3>
                <p class="mt-1 text-gray-600">–ü—É–±–ª—ñ–∫—É—î–º–æ –≤—Å—ñ –∑–≤—ñ—Ç–∏ —Ç–∞ –≤–∏—Å–Ω–æ–≤–∫–∏ –¥–ª—è –≥—Ä–æ–º–∞–¥—Å—å–∫–æ—Å—Ç—ñ</p>
              </div>
            </div>
            <div class="flex gap-4">
              <div class="flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-lg bg-blue-100">
                <span class="text-xl">ü§ù</span>
              </div>
              <div>
                <h3 class="font-bold text-gray-900">–ì—Ä–æ–º–∞–¥—Å—å–∫–∞ –£—á–∞—Å—Ç—å</h3>
                <p class="mt-1 text-gray-600">–ó–∞–ª—É—á–∞—î–º–æ –≥—Ä–æ–º–∞–¥—Å—å–∫—ñ—Å—Ç—å –¥–æ –∫–æ–Ω—Ç—Ä–æ–ª—é –≤–∏—Ç—Ä–∞—Ç –¥–µ—Ä–∂–∞–≤–∏</p>
              </div>
            </div>
          </div>
        </div>
        <div class="flex justify-center rounded-xl border border-gray-100 bg-white p-4 shadow-sm overflow-hidden min-h-[400px]">
          <div class="w-full max-w-[500px]">
            <div class="fb-page" 
              data-href="https://www.facebook.com/IPAOua" 
              data-tabs="timeline"
              data-width="500" 
              data-height=""
              data-small-header="false" 
              data-adapt-container-width="true" 
              data-hide-cover="false" 
              data-show-facepile="false">
              <blockquote cite="https://www.facebook.com/IPAOua" class="fb-xfbml-parse-ignore">
                <a href="https://www.facebook.com/IPAOua">–û—Ñ—ñ—Å –ù–µ–∑–∞–ª–µ–∂–Ω–æ–≥–æ –ì—Ä–æ–º–∞–¥—Å—å–∫–æ–≥–æ –ê—É–¥–∏—Ç—É</a>
              </blockquote>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      const updateFacebookPluginWidth = () => {
        const fbPage = document.querySelector('.fb-page');
        const container = fbPage?.parentElement;
        
        if (fbPage && container) {
          // Get parent width - container is the w-full max-w-[500px] div
          const containerWidth = container.offsetWidth;
          
          if (containerWidth === 0) return;

          // FB Plugin min is 180, max is 500.
          // We want it to fill the container up to 500.
          const newWidth = Math.min(Math.max(containerWidth, 180), 500);
          
          const currentWidth = fbPage.getAttribute('data-width');
          
          // Only update and re-parse if width is significantly different (to avoid jitter)
          if (currentWidth !== Math.floor(newWidth).toString()) {
            fbPage.setAttribute('data-width', Math.floor(newWidth).toString());
            if (window.FB) {
              // Re-parse the container to force layout refresh
              FB.XFBML.parse(container);
            }
          }
        }
      };

      let timeout;
      const handleResize = () => {
        clearTimeout(timeout);
        timeout = setTimeout(updateFacebookPluginWidth, 500);
      };

      window.addEventListener('resize', handleResize);
      // Run on various load events to ensure it catches the layout
      window.addEventListener('load', updateFacebookPluginWidth);
      document.addEventListener('astro:page-load', updateFacebookPluginWidth);
      
      // Try multiple times to catch delayed layout
      setTimeout(updateFacebookPluginWidth, 500);
      setTimeout(updateFacebookPluginWidth, 2000);
    </script>
  </section>

  <!-- CTA Section -->
  <section id="donate" class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-20">
    <div class="rounded-lg border-l-4 border-blue-700 bg-white p-12 text-center shadow-lg">
      <h2 class="text-4xl font-bold text-gray-900">–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ –ù–∞—à—É –†–æ–±–æ—Ç—É</h2>
      <p class="mt-4 text-xl text-gray-600 leading-relaxed">
        –í–∞—à–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ –¥–∞—î –Ω–∞–º –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø—Ä–æ–¥–æ–≤–∂—É–≤–∞—Ç–∏ –±–æ—Ä–æ—Ç—å–±—É –∑ –∫–æ—Ä—É–ø—Ü—ñ—î—é
      </p>
      <button class="mt-8 rounded-lg bg-blue-700 px-8 py-3 font-bold text-white hover:bg-blue-800 transition-colors">
        –ó—Ä–æ–±–∏—Ç–∏ –ü–æ–∂–µ—Ä—Ç–≤—É
      </button>
    </div>
  </section>
</Layout>
